<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>礼金簿 - 副屏展示</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #fff8f8;
            color: #d32f2f;
            font-family: "Microsoft Yahei", SimHei, sans-serif;
        }
        .screen-container {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }
        .title {
            font-size: 3rem;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(211, 47, 47, 0.2);
        }
        .stats-container {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 50px;
            flex-wrap: wrap;
        }
        .stat-item {
            background: linear-gradient(to right, #d32f2f, #ff6b6b);
            color: white;
            padding: 30px 50px;
            border-radius: 20px;
            box-shadow: 0 8px 24px rgba(211, 47, 47, 0.2);
        }
        .stat-label {
            font-size: 1.5rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        .stat-value {
            font-size: 3rem;
            font-weight: bold;
        }
        .list-container {
            background: white;
            border-radius: 20px;
            border: 3px solid #d32f2f;
            padding: 30px;
            max-height: 500px;
            overflow-y: auto;
        }
        .gift-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px dashed #ffcccc;
            font-size: 1.2rem;
        }
        .gift-name {
            font-weight: 600;
        }
        .gift-amount {
            color: #d32f2f;
            font-weight: bold;
        }
        /* 自动刷新提示 */
        .refresh-tip {
            margin-top: 20px;
            font-size: 1rem;
            color: #7f0000;
        }
    </style>
</head>
<body>
    <div class="screen-container">
        <h1 class="title"> 喜庆礼金簿 - 副屏展示 </h1>
        
        <div class="stats-container">
            <div class="stat-item">
                <div class="stat-label">总人数</div>
                <div class="stat-value" id="total-people">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">总金额</div>
                <div class="stat-value" id="total-amount">¥0.00</div>
            </div>
        </div>

        <div class="list-container" id="gift-list">
            <!-- 数据动态填充 -->
        </div>

        <div class="refresh-tip"> 数据每10秒自动刷新</div>
    </div>

    <script>
        // 登录验证
        const token = localStorage.getItem('token');
        if (!token) {
            window.location.href = 'auth.html';
        }

        // 加载数据（副屏专用，仅展示，无操作）
        async function loadScreenData() {
            try {
                const res = await fetch('/api/gifts', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                if (data.code === 0) {
                    const giftList = data.data;
                    // 更新统计
                    document.getElementById('total-people').textContent = giftList.length;
                    const total = giftList.reduce((sum, item) => sum + Number(item.amount), 0);
                    document.getElementById('total-amount').textContent = `¥${total.toFixed(2)}`;
                    // 渲染列表（倒序展示最新记录）
                    const listEl = document.getElementById('gift-list');
                    listEl.innerHTML = '';
                    // 取最新的20条记录（副屏展示）
                    const latestList = giftList.slice(-20).reverse();
                    latestList.forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'gift-item';
                        div.innerHTML = `
                            <div class="gift-name">${item.name}</div>
                            <div class="gift-amount">¥${item.amount}</div>
                        `;
                        listEl.appendChild(div);
                    });
                }
            } catch (err) {
                console.error('加载副屏数据失败:', err);
            }
        }

        // 初始加载
        loadScreenData();
        // 每10秒自动刷新
        setInterval(loadScreenData, 10000);
    </script>
</body>
</html>